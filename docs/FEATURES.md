# HNW 홍보 아카이브 - 기능 목록

## 주요 기능

### 1. 홈 화면 (메인 대시보드)

#### 통계 대시보드
- 전체 기사 수, 이벤트 수, 언론사 수 표시
- 카테고리별 도넛 차트 (인터뷰, 세미나 안내, 소개 및 홍보)
- 태그별 요약 카드 (단독기사, 특집기사, 보도기사)
  - 전체 건수 및 distinct 건수 표시
  - 보도기사: 이벤트명 기준 중복 제거
  - 단독기사/특집기사: 이벤트명 + 발행일 기준 중복 제거

#### 월별 타임라인
- "전체" 선택 시: 최근 12개월 롤링 데이터
- 특정 연도 선택 시: 해당 연도 월별 데이터
- 월 클릭 시 목록 화면으로 이동

#### 하이라이트 섹션
- 단독기사/특집기사 중 최신 5개 표시
- 카드 형태로 시각적 강조

#### 최근 이벤트별 기사
- 최근 등록된 기사 목록 (이벤트별 그룹화)
- 최대 5개 그룹 표시

---

### 2. 홍보 목록 (리스트 뷰)

#### 검색 및 필터
- **검색**: 기사 제목, 키워드, 언론사명
- **연도 탭**: 전체 / 특정 연도
- **카테고리 필터**: 전체, 인터뷰, 세미나 안내, 소개 및 홍보
- **태그 필터**: 전체, 단독기사, 특집기사, 보도기사
  - 각 태그별 distinct 건수 표시

#### 이벤트별 그룹화
- 같은 이벤트명을 가진 기사를 그룹으로 표시
- 펼치기/접기 기능
- 연관 기사 개수 표시

#### 기사 카드
- 썸네일 이미지, 제목, 언론사, 발행일
- 카테고리 및 태그 배지
- 클릭 시 원문 링크로 이동

---

### 3. 홍보 캘린더

#### 월별 캘린더
- 기사, 일정, 세미나가 있는 날짜에 아이콘 표시
- **아이콘 타입별 구분** (2026-02-04 개선):
  - 기사: 사각형 (카테고리별 색상)
    - 인터뷰: 보라색
    - 세미나 안내: 주황색
    - 소개 및 홍보: 파란색
  - 세미나: 주황색 원
  - 일정: 삼각형 (카테고리별 색상)
    - 회의: 초록색
    - 외근: 노란색
    - 기타: 분홍색
- 모든 아이콘 크기 통일 (10px)
- **월 변경 기능**:
  - 좌우 화살표 버튼 클릭
  - 달력 위에서 좌우 스와이프 (50px 이상)
- **자동 선택 기능**:
  - 초기 로딩 시: 가장 가까운 미래 일정/기사/세미나 자동 선택
  - 월 변경 시: 해당 월의 첫 번째 일정/기사/세미나 자동 선택

#### 날짜 선택
- 날짜 클릭 시 해당 날짜의 기사/일정/세미나 목록 표시
- 하단에 카드 리스트
- 빈 섹션은 자동 숨김 처리

---

### 4. 세미나 관리

#### 세미나 현황 대시보드
- **통계 카드**:
  - 정기 세미나 (준비중/완료 건수)
  - 비정기 세미나 요청 (대기/승인 건수)
  - 카테고리별 통계 (패밀리오피스/법인)
  - 이번 주 세미나 알림
- **클릭 시 스크롤 이동**:
  - 정기 카드 → 다가오는 세미나
  - 비정기 카드 → 비정기 요청 섹션

#### 세미나 캘린더
- 월별 캘린더에 세미나 일정 표시
- 색상 구분:
  - 정기 세미나: 카테고리별 (보라/하늘)
  - 비정기 요청: 주황색
- **월 변경 기능**:
  - 좌우 화살표 버튼 클릭
  - 달력 위에서 좌우 스와이프 (50px 이상)

#### 세미나 등록/수정
- **정기 세미나**:
  - 제목, 날짜, 장소, 카테고리
  - 법인 유형, 대상 유형
  - 예상 참석자 수, 실제 참석자 수
- **비정기 세미나 요청**:
  - 요청센터, 요청장소, 대상법인
  - 모집인원 (최소~최대)
  - 요청일자, 요청주제
  - 접수자, 센터 담당자
  - 비고 (리사이즈 가능, 30자 이상 시 말줄임)

#### 체크리스트 관리
- **3단계 체크리스트**: 사전 / 당일 / 사후
- **진행률 시각화**: 전체 및 단계별 진행률
- **항목별 목표일**: D-14, D-7, D-1 등 표시
- **항목 관리**: 추가, 삭제, 완료 토글

#### 비정기 세미나 요청 목록
- 요청일자 기준 오름차순 정렬 (임박한 요청이 상단)
- D-day 표시:
  - 7일 이내: 빨간색
  - 이후: 주황색
- 비고 미리보기 (30자 이상 시 말줄임)
- 클릭 시 전체 비고 팝업

---

### 5. 일정 관리 (신규 - 2026-02-04)

#### 일정 카테고리
- **회의**: 팀회의, 외부미팅, 부서간회의
- **외근**: 직원미팅, 고객미팅

#### 회의 관리
- 회의 유형 선택
- 회의 주제 입력
- 날짜, 시간, 장소 지정

#### 외근 관리
- **공통 정보**:
  - 외근 유형 (직원미팅/고객미팅)
  - 센터, 담당RM, 연락처
  - 날짜, 시간, 장소
  - 미팅 주제
  - 준비물
- **고객미팅 추가 정보**:
  - 고객명
  - 고객 기타정보

#### 일정 뷰
- 월별 그룹화 표시
- 카테고리 필터 (전체/회의/외근)
- 날짜 오름차순 정렬 (가장 가까운 일정이 상단)

#### 권한
- 조회: 로그인 불필요
- 등록/수정/삭제: 로그인 필요

---

### 6. 자료실

#### 카테고리별 문서 관리
- **회의록**: 내부회의록, 외부회의록, 한장요약
- **보고서**: 전문, 요약
- **기획안**

#### 파일 관리
- **파일 그룹화**: 동일 파일명 다른 확장자 파일을 하나의 카드로 그룹화
- **파일 저장**: MongoDB에 base64로 저장 (Vercel 배포 호환)
- **한글 파일명 지원**: 유니코드 정규화 (NFC) 적용

#### 파일 뷰어
- **PDF**: iframe으로 직접 표시
- **Office 파일** (doc, docx, ppt, pptx, xls, xlsx): Google Docs Viewer 사용
- **모바일 대응**: Google Docs Viewer 사용으로 모바일 뷰어 지원
- **뷰어 실패 시**: 다운로드 폴백

#### 검색 및 정렬
- 파일명, 제목 검색
- 최신 파일이 위로 (uploadedAt 내림차순)

#### 성능 최적화
- 프론트엔드 캐싱: 30초 TTL
- stale-while-revalidate 패턴

#### 권한
- 특정 이메일(tobeapro@gmail.com, sweetas11@nhsec.com) 또는 관리자만 접근 가능

---

### 7. 기사관리 (관리자 전용)

#### 기사 CRUD
- 기사 추가, 수정, 삭제
- 썸네일 이미지 URL 입력
- 이벤트명 입력 (그룹화용)

#### 자동 크롤링
- 기사 저장 후 관련 기사 자동 검색
- Google News RSS 활용

#### 일괄 등록
- 검색된 기사 선택하여 일괄 저장
- 썸네일 일괄 다운로드 (기존 이미지 건너뛰기)

#### 권한
- 관리자 전용

---

### 8. 웹 푸시 알림

#### 푸시 구독
- **설정 화면**: 알림 구독/해제 토글
- **권한 요청**: 브라우저 알림 권한 자동 요청
- **구독 방식**: 로그인 필요 (2026-02-04 업데이트)
- **Service Worker**: 백그라운드 푸시 수신

#### 알림 타입 (2026-02-06 업데이트)
- **notificationTypes 배열**: 사용자별 알림 유형 선택 가능
  - `dday`: 세미나 D-day 알림
  - `daily`: 금일 일정 알림 + 일정 리마인더
- **기존 구독자 호환**: `notificationTypes` 필드가 없는 기존 구독자도 `$exists: false` fallback으로 알림 수신

#### D-day 알림
- **발송 시간**: 매일 오전 10시(KST)
- **크론 경로**: `/api/cron/notifications`
- **크론 스케줄**: `0 1 * * *` (UTC)
- **알림 내용**:
  - 패밀리오피스: 가장 가까운 예정 세미나
  - 법인: 가장 가까운 예정 세미나
  - 각 카테고리별 1건씩 (총 2건)
- **알림 클릭**: 세미나 탭으로 자동 이동 (`/?tab=seminar`)

#### 금일 일정 알림 (2026-02-06 신규)
- **발송 시간**: 매일 오전 8시(KST)
- **크론 경로**: `/api/cron/daily-schedule`
- **크론 스케줄**: `0 23 * * *` (UTC, 전날 23시 = KST 다음날 8시)
- **알림 내용**:
  - 금일 세미나(준비중) + 일정(회의/외근) 합산
  - 최대 3건 표시, 초과 시 "외 N건"
- **알림 클릭**: 캘린더 탭으로 자동 이동 (`/?tab=calendar`)

#### 일정 리마인더 (2026-02-06 신규)
- **발송 조건**: 5분마다 체크
- **크론 경로**: `/api/cron/schedule-reminder`
- **크론 스케줄**: `*/5 * * * *`
- **리마인더 규칙**:
  - 회의: 시작 20분 전 알림
  - 외근: 시작 1시간(60분) 전 알림
- **중복 방지**: `notification_logs`에 발송 기록 저장, 같은 일정 당일 중복 발송 없음
- **알림 클릭**: 캘린더 탭으로 자동 이동 (`/?tab=calendar`)

#### 보안
- VAPID 인증 (Web Push Protocol)
- CRON_SECRET으로 크론 작업 보호

---

### 9. 사용자 관리 (관리자 전용)

#### 사용자 목록
- 관리자/일반 사용자 분리 표시
- 이메일, 이름, 가입일 표시

#### 권한 관리
- **세부 권한 설정**:
  - 기사: 등록/수정/삭제 권한
  - 세미나: 등록/수정/삭제 권한
- **관리자 승격/해제**: 일반 사용자 ↔ 관리자 전환
- **보호된 계정**: admin@hnw.co.kr 해제 버튼 숨김

#### 권한
- 관리자 전용

---

## 권한 체계 (2026-02-04 업데이트)

### 접근 권한 정책

| 기능 | 비로그인 사용자 | 일반 사용자 | 특정 이메일 | 관리자 |
|------|----------------|------------|------------|--------|
| 홈/목록/캘린더/세미나 (조회) | ✅ | ✅ | ✅ | ✅ |
| 일정 (조회) | ✅ | ✅ | ✅ | ✅ |
| 일정 (등록/수정/삭제) | ❌ | ✅ | ✅ | ✅ |
| 푸시 알림 | ❌ | ✅ | ✅ | ✅ |
| 자료실 | ❌ | ❌ | ✅ | ✅ |
| 기사관리 | ❌ | ❌ | ❌ | ✅ |
| 사용자 관리 | ❌ | ❌ | ❌ | ✅ |

### 권한 정책 상세

1. **홈, 목록, 캘린더, 세미나**: 로그인 없이 조회 가능
2. **일정**: 조회는 로그인 없이 가능, 등록/수정/삭제는 로그인 필요
3. **푸시 알림**: 로그인한 사용자만 구독 가능
4. **자료실**: 특정 이메일 또는 관리자만 접근 가능
   - tobeapro@gmail.com
   - sweetas11@nhsec.com
5. **기사관리**: 관리자 전용
6. **사용자 관리**: 관리자 전용

---

## UI/UX 특징

### NDS 디자인가이드 기반 UI 개선 (2026-02-06)

#### 토스트 알림 (sonner)
- **라이브러리**: sonner
- **위치**: 하단 중앙 (`bottom-center`)
- **타입별 사용**:
  - `toast.success()`: 저장/삭제 성공
  - `toast.error()`: API 오류, 네트워크 오류
  - `toast.warning()`: 유효성 검증 실패
- **기존 alert() 44개소 전면 교체**

#### EmptyState 컴포넌트
- **파일**: `src/components/ui/empty-state.tsx`
- **구성**: 아이콘 + 제목 + 설명(옵션) + CTA 버튼(옵션)
- **적용 화면**: 기사 목록, 일정, 자료실, 세미나, 체크리스트 등 10개소

#### 터치 영역 확대 (WCAG 접근성)
- **기본**: 40px (Button default, Input, TabsList, SelectTrigger, Switch)
- **최대**: 44px (Button lg)
- **변경 파일**: button.tsx, input.tsx, tabs.tsx, select.tsx, switch.tsx

#### 모달 스크롤 방지 통일
- **패턴**: `position: fixed` + `scroll position restore`
- **적용**: settings-dialog, resource-viewer, resource-form-dialog 등 모든 모달

### 하단 네비게이션
- 홈, 목록, 캘린더, 세미나, 일정
- 로그인 시: 자료실, 기사관리 탭 추가

### 토스트 팝업
- 하단에서 올라오는 슬라이드 팝업 (`animate-in slide-in-from-bottom`)
- 컴팩트 헤더, 스크롤 가능한 콘텐츠, 고정 푸터

### 색상 코드

#### 세미나 카테고리
- 패밀리오피스: 보라색 (`violet-500`)
- 법인: 하늘색 (`sky-500`)

#### 세미나 유형
- 정기: 초록색 (`emerald-500`)
- 비정기: 주황색 (`amber-500`)

#### 체크리스트 단계
- 사전: 노란색 (`amber-500`)
- 당일: 주황색 (`orange-500`)
- 사후: 초록색 (`emerald-500`)

#### 일정 카테고리
- 회의: 파란색
- 외근: 회색

---

## 성능 최적화

### MongoDB 인덱스
- articles: publishedAt, category, tag, eventId
- seminars: date, category+status, seminarType
- checklist_items: seminarId (N+1 쿼리 해결)
- seminar_requests: requestedDate, status
- resources: category+subCategory, uploadedAt
- schedules: date, category

### 쿼리 최적화
- $lookup 집계 파이프라인으로 N+1 쿼리 제거
- API 병렬화 (Promise.all)

### HTTP 캐싱
- `Cache-Control: public, s-maxage=30, stale-while-revalidate=60`
- 30초 CDN 캐시 + 60초 백그라운드 갱신

---

## 업데이트 이력

### 2026-02-06
- NDS 디자인가이드 기반 UI 개선:
  - sonner 토스트 도입 (alert 44개소 → toast 교체)
  - EmptyState 컴포넌트 생성 및 10개소 적용
  - 터치 영역 확대 (버튼/입력/탭/셀렉트/스위치 최소 40px)
  - 모달 스크롤 방지 position:fixed 패턴 통일
- 금일 일정 알림 크론 추가 (매일 오전 8시 KST)
- 일정 리마인더 크론 추가 (회의 20분전, 외근 1시간전)
- 알림 타입별 구독 관리 (dday/daily)
- 푸시 알림 기존 구독자 fallback 쿼리 수정

### 2026-02-04
- 권한 체계 개선 (푸시 알림 로그인 필수)
- 일정 관리 기능 추가
- 캘린더 UX 개선:
  - 홍보 캘린더 및 세미나 캘린더에 스와이프 제스처 추가
  - 초기 로딩 시 가장 가까운 미래 일정 자동 선택
  - 월 변경 시 해당 월의 첫 번째 일정 자동 선택
- 일정 정렬 변경 (날짜 오름차순)

### 2026-01-29
- 자료실 기능 추가
- 자료실 성능 최적화
- 세미나 프론트엔드 캐싱

### 2026-01-28
- MongoDB 인덱스 추가
- 세미나 API N+1 쿼리 제거
- 비정기 세미나 요청 개선
- 푸시 알림 랜딩 개선

### 2026-01-27
- 웹 푸시 알림 구현
- D-day 알림 크론
- 설정 화면 추가
